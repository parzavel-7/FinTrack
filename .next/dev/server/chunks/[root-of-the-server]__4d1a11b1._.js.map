{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/prac/PROJECTS/FinTrack/fin_track/src/app/api/ai-insights/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const data = await req.json();\r\n    const { transactions, goals, totals } = data;\r\n\r\n    const apiKey = process.env.OPENROUTER_API_KEY;\r\n    const appName = process.env.NEXT_PUBLIC_APP_NAME || \"FinTrack\";\r\n\r\n    if (!apiKey) {\r\n      return NextResponse.json(\r\n        { error: \"OpenRouter API key not configured\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    const prompt = `\r\n      As a personal financial advisor, analyze the following financial data and provide 3-5 actionable insights.\r\n      \r\n      Financial Summary:\r\n      - Total Income: $${totals.income}\r\n      - Total Expenses: $${totals.expenses}\r\n      - Current Savings: $${totals.savings}\r\n      \r\n      Goals:\r\n      ${goals.map((g: any) => `- ${g.name}: Target $${g.target_amount}, Current $${g.current_amount}, Status: ${g.status}`).join('\\n')}\r\n      \r\n      Recent Transactions:\r\n      ${transactions.slice(0, 10).map((t: any) => `- ${t.date}: ${t.description || 'No description'} ($${t.amount}) - ${t.type}`).join('\\n')}\r\n      \r\n      Respond STRICTLY in JSON format with the following structure:\r\n      {\r\n        \"insights\": [\r\n          {\r\n            \"id\": \"unique-id\",\r\n            \"type\": \"tip\" | \"warning\" | \"success\" | \"info\",\r\n            \"title\": \"Short title\",\r\n            \"description\": \"Explanatory text\",\r\n            \"category\": \"spending\" | \"savings\" | \"goals\" | \"general\",\r\n            \"actionLabel\": \"Optional button text\",\r\n            \"actionUrl\": \"Optional relative path\"\r\n          }\r\n        ],\r\n        \"summary\": \"A brief overview sentence of the financial health.\"\r\n      }\r\n    `;\r\n\r\n    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Authorization\": `Bearer ${apiKey}`,\r\n        \"HTTP-Referer\": \"https://github.com/google/fintrack\",\r\n        \"X-Title\": appName,\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        model: \"google/gemini-2.0-flash-001\", // Switched from Claude 3.5 Sonnet\r\n        messages: [\r\n          {\r\n            role: \"system\",\r\n            content: \"You are a helpful financial assistant that provides concise, actionable insights in valid JSON format.\"\r\n          },\r\n          {\r\n            role: \"user\",\r\n            content: prompt\r\n          }\r\n        ],\r\n        response_format: { type: \"json_object\" }\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      let errorDetail;\r\n      try {\r\n        errorDetail = JSON.parse(errorText);\r\n      } catch {\r\n        errorDetail = errorText;\r\n      }\r\n      \r\n      console.error(\"OpenRouter API Error Status:\", response.status);\r\n      console.error(\"OpenRouter API Error Detail:\", errorDetail);\r\n      \r\n      return NextResponse.json(\r\n        { \r\n          error: \"OpenRouter API error\", \r\n          details: errorDetail?.error?.message || \"Failed to fetch from OpenRouter\" \r\n        },\r\n        { status: response.status }\r\n      );\r\n    }\r\n\r\n    const result = await response.json();\r\n    const aiContent = JSON.parse(result.choices[0].message.content);\r\n\r\n    return NextResponse.json({\r\n      ...aiContent,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"AI Insights Route Error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;QAExC,MAAM,SAAS,QAAQ,GAAG,CAAC,kBAAkB;QAC7C,MAAM,UAAU,gDAAoC;QAEpD,IAAI,CAAC,QAAQ;YACX,OAAO,yKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,CAAC;;;;uBAIG,EAAE,OAAO,MAAM,CAAC;yBACd,EAAE,OAAO,QAAQ,CAAC;0BACjB,EAAE,OAAO,OAAO,CAAC;;;MAGrC,EAAE,MAAM,GAAG,CAAC,CAAC,IAAW,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE,EAAE,aAAa,CAAC,WAAW,EAAE,EAAE,cAAc,CAAC,UAAU,EAAE,EAAE,MAAM,EAAE,EAAE,IAAI,CAAC,MAAM;;;MAGjI,EAAE,aAAa,KAAK,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,IAAW,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,WAAW,IAAI,iBAAiB,GAAG,EAAE,EAAE,MAAM,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,IAAI,CAAC,MAAM;;;;;;;;;;;;;;;;;IAiBzI,CAAC;QAED,MAAM,WAAW,MAAM,MAAM,iDAAiD;YAC5E,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,QAAQ;gBACnC,gBAAgB;gBAChB,WAAW;gBACX,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBACE,MAAM;wBACN,SAAS;oBACX;oBACA;wBACE,MAAM;wBACN,SAAS;oBACX;iBACD;gBACD,iBAAiB;oBAAE,MAAM;gBAAc;YACzC;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,IAAI;YACJ,IAAI;gBACF,cAAc,KAAK,KAAK,CAAC;YAC3B,EAAE,OAAM;gBACN,cAAc;YAChB;YAEA,QAAQ,KAAK,CAAC,gCAAgC,SAAS,MAAM;YAC7D,QAAQ,KAAK,CAAC,gCAAgC;YAE9C,OAAO,yKAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,SAAS,aAAa,OAAO,WAAW;YAC1C,GACA;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAE9B;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAClC,MAAM,YAAY,KAAK,KAAK,CAAC,OAAO,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QAE9D,OAAO,yKAAY,CAAC,IAAI,CAAC;YACvB,GAAG,SAAS;YACZ,WAAW,IAAI,OAAO,WAAW;QACnC;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,yKAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}